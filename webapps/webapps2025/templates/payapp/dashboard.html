{% extends 'base.html' %}
{% block body_class %}theme-hero{% endblock %}
{% load crispy_forms_tags %}

{% block content %}
<section class="dashboard-wrap">
  <div class="dashboard-card card">
    <div class="card-header text-center dashboard-head">
      <h2 class="mb-0">Dashboard</h2>
    </div>

    <div class="card-body text-center">
      <h4 class="mb-1">Welcome, {{ user.username }}!</h4>
      <p class="lead mb-3">
        Your Balance:
        <strong>{{ account.balance }} {{ account.user.currency }}</strong>
      </p>
      <hr>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="card border-info h-100">
            <div class="card-header">Recent Transactions</div>
            <div class="card-body">
              {% if transaction_display_data %}
                <ul class="list-group">
                  {% for transaction in transaction_display_data %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      {{ transaction.status }} â€” {{ transaction.display_amount }}
                      <span class="text-muted">
                        {{ transaction.timestamp|date:"Y-m-d H:i" }}
                      </span>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted mb-0">No recent transactions.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card border-warning h-100">
            <div class="card-header">Account Insights</div>
            <div class="card-body text-start">
              <p class="mb-2"><strong>Total Transactions:</strong> {{ total_transactions }}</p>
              <p class="mb-2">
                <strong>Last Transaction:</strong>
                {% if last_transaction %}
                  {% if last_transaction.converted_amount %}
                    {{ last_transaction.converted_amount }} {{ last_transaction.converted_currency }}
                  {% else %}
                    {{ last_transaction.amount }} {{ account.user.currency }}
                  {% endif %}
                  on {{ last_transaction.timestamp|date:"Y-m-d H:i" }}
                {% else %}
                  No transactions yet.
                {% endif %}
              </p>
              <p class="mb-0"><strong>Most Used Currency:</strong> {{ most_used_currency }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <a href="{% url 'transaction_history' %}" class="btn btn-dashboard px-4">View All Transactions</a>
      </div>

      <p class="text-muted mt-3 mb-0">Keep track of your spending and manage your finances efficiently.</p>
    </div>
  </div>
</section>

{% if messages %}
  {% for message in messages %}
    {% if message.tags == 'success' %}
      <div class="alert alert-success alert-dismissible fade show position-fixed bottom-0 start-50 translate-middle-x mb-3" role="alert" style="z-index:1080; max-width:640px;">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endif %}
  {% endfor %}
{% endif %}
{% endblock %}
